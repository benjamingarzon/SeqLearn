---
title: "R Notebook"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
---



```{r}
rm(list=ls())
library(ggplot2)
library(reshape2)
library(dplyr)
library(GGally)
library(network)
library(boot)
library(rstan)

options(mc.cores = parallel::detectCores())
suffix = '20181023_1033-KIpilot0db'
keysfile = paste0('../data/archive/keys_table-', suffix, '.csv')
trialsfile = paste0('../data/archive/trials_table-', suffix, '.csv')
memofile = paste0('../data/archive/memo_table-', suffix, '.csv')

keys.table = read.table(keysfile, sep =';', header = T, quote = "")
trials.table = read.table(trialsfile, sep =';', header = T,quote = "")
memo.table = read.table(memofile, sep =';', header = T,quote = "")
#keys.melt = melt(keys.table, id.vars = c("cumulative_trial","trial","keystroke","response") )
#trials.melt = melt(keys.table, id.vars = c("cumulative_trial","trial","keystroke","response") )

```
Analyze chords

```{r}
keys.table = subset(keys.table, keystroke > 0) # only after movement started 
keys.table = subset(keys.table, accuracy == 1)

plot.keystroke = ggplot(keys.table, aes(x = key_to, y = RT)) + geom_point() 

keys.table.median = keys.table %>% group_by(key_from, key_to) %>% summarise(RT = median(RT))

plot.keystrokepairs = ggplot(keys.table.median, aes(x = key_from, y = key_to, fill = RT)) + geom_tile() + theme_classic()

#keys.table.mat = as.matrix(acast(keys.table.median, key_from ~ key_to, value.var="RT"), margins = T, drop = F)
#net = network(keys.table.mat, directed = TRUE, na.omit = T, matrix.type = "adjacency")

print(plot.keystroke)
print(plot.keystrokepairs)

```

Analyze memo

```{r}

# check missed as well
ok_memo = subset(memo.table, accuracy == 1)

plot.RT = ggplot(ok_memo, aes(x = sess_num, y = RT, col = true_sequence, group = true_sequence, lty = as.factor(seq_train))) + geom_line(lwd=1) + geom_point() + facet_grid( username ~ .) + theme(legend.position="right")

plot.attempts = ggplot(memo.table, aes(x = true_sequence, fill = as.factor(seq_train))) + geom_bar() + facet_grid( username ~ sess_num) + theme(axis.text.x = element_text(angle = 90, hjust = 1))

plot.totalRT = ggplot(memo.table %>% group_by(username, sess_num, true_sequence, seq_train) %>% summarise(totalRT = sum(RT)), aes(x = sess_num, y = totalRT, col = true_sequence, group = true_sequence, lty = as.factor(seq_train))) + geom_point() + geom_line(lwd=1) + facet_grid( username ~ .) + theme(legend.position="right") 



print(plot.RT)
print(plot.attempts)
print(plot.totalRT)

```



Analyze trials
```{r}


ok_trials = subset(trials.table, accuracy == 1)
unpaced_trials = subset(trials.table, paced == 0)
paced_trials = subset(trials.table, paced == 1 & accuracy == 1)
                      
plot.RT = ggplot(ok_trials, aes(x = trial, y = RT, col = true_sequence, group = true_sequence, lty = as.factor(seq_train))) + geom_line(lwd=1) + geom_point() + facet_grid( username ~ sess_num + paced) + theme(legend.position="none")
plot.MT = ggplot(ok_trials, aes(x = trial, y = MT, col = true_sequence, group = true_sequence, lty = as.factor(seq_train))) + geom_line(lwd=1) + geom_point() + facet_grid( username ~ sess_num + paced) + theme(legend.position="none")
plot.acc = ggplot(unpaced_trials, aes(x = trial, y = accuracy, col = true_sequence, group = true_sequence, lty = as.factor(seq_train))) + geom_line(lwd=1) + geom_point() + facet_grid( username ~ sess_num) + theme(legend.position="none")

print(plot.RT)
print(plot.MT)
print(plot.acc)

```





```{r}
paced_trials$diff.exec_fix = paced_trials$clock_execution  - paced_trials$clock_fixation
paced_trials$diff.feed_exec = paced_trials$clock_feedback  - paced_trials$clock_execution 

hist(paced_trials$diff.exec_fix, 50)
hist(paced_trials$diff.feed_exec, 50)

```

Analyze duration


```{r}
plot.duration = ggplot(trials.table, aes(x = sess_num, y = clock_feedback, col = username, group = username)) + stat_summary(fun.y = max, geom = "point") + geom_line(lwd=1) + ylab("Session duration")

print(plot.duration)

```

Analyze clocks

```{r}

trialsfile = paste0('../data/archive/trialsfile-kip0s001.csv')
trials.table = read.table(trialsfile, sep =';', header = T, quote = "")
paced_trials = subset(trials.table, paced == 1 & sess_num >2  & accuracy == 1)
                      
plot.fixation = ggplot(paced_trials, aes(x = trial, y = clock_fixation, group = sess_num, col = sess_num, lty = as.factor(seq_train))) + geom_line(lwd=1) + geom_point() + facet_grid( username ~ true_sequence ) + theme(legend.position="none")

print(plot.fixation)

```